DROP TABLE IF EXISTS tbl1;
DROP TABLE IF EXISTS tbl2;
DROP TABLE IF EXISTS tbl3;
DROP DATABASE IF EXISTS cus_test;
CREATE DATABASE cus_test;
USE cus_test;
CREATE TABLE tbl1 (
col1_1 INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
col1_2 INT NOT NULL,
col1_3 INT NOT NULL,
col1_4 INT NOT NULL);
INSERT INTO tbl1 (col1_2, col1_3, col1_4) VALUES (2, 3, 4);
INSERT INTO tbl1 (col1_2, col1_3, col1_4) VALUES (3, 4, 5);
INSERT INTO tbl1 (col1_2, col1_3, col1_4) VALUES (4, 5, 6);
CREATE TABLE tbl2 (col2_1 INT NOT NULL, col2_2 INT NOT NULL);
INSERT INTO tbl2 (col2_1, col2_2) VALUES (2, 3);
CREATE TABLE tbl3 (
col1_1 INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
col1_2 INT NOT NULL,
col3_3 INT NOT NULL);
INSERT INTO tbl3 (col1_2, col3_3) VALUES (2, 83);
INSERT INTO tbl3 (col1_2, col3_3) VALUES (3, 84);
INSERT INTO tbl3 (col1_2, col3_3) VALUES (4, 85);
set global column_stats_control = ON;
SET @start_value = @@global.performance_schema_esms_by_all;
SET @@global.performance_schema_esms_by_all = ON;
SELECT col1_1, col2_2 FROM tbl1 INNER JOIN tbl2 ON col1_2 = col2_2 WHERE col1_1 IN (1, 2, 3);
col1_1	col2_2
2	3
SELECT * FROM tbl1 NATURAL JOIN tbl3;
col1_1	col1_2	col1_3	col1_4	col3_3
1	2	3	4	83
2	3	4	5	84
3	4	5	6	85
SELECT col1_1, col2_2 FROM tbl1 STRAIGHT_JOIN tbl2 ON col1_2 = col2_2;
col1_1	col2_2
2	3
SELECT * FROM tbl1 JOIN tbl3 USING (col1_2);
col1_2	col1_1	col1_3	col1_4	col1_1	col3_3
2	1	3	4	1	83
3	2	4	5	2	84
4	3	5	6	3	85
SELECT tbl1.col1_1, tbl2.col2_2 FROM tbl1, tbl2 WHERE tbl1.col1_2 IN (1, 2, 3);
col1_1	col2_2
1	3
2	3
SELECT tbl1.col1_1, tbl2.col2_2 FROM tbl1 JOIN tbl2 ON tbl1.col1_2 = col2_2 WHERE tbl1.col1_2 IN (1, 2, 3);
col1_1	col2_2
2	3
SELECT tbl1.col1_1, tbl2.col2_2 FROM tbl1 JOIN tbl2 ON tbl1.col1_2 > col2_2;
col1_1	col2_2
3	3
SELECT * FROM (tbl1, tbl2) JOIN tbl3 ON (tbl1.col1_1 = tbl3.col1_1);
col1_1	col1_2	col1_3	col1_4	col2_1	col2_2	col1_1	col1_2	col3_3
1	2	3	4	2	3	1	2	83
2	3	4	5	2	3	2	3	84
3	4	5	6	2	3	3	4	85
SELECT tbl1.col1_1, col2_2 FROM tbl1, (SELECT * FROM tbl2 WHERE col2_2 = 3) t2 WHERE col2_1 = 2 AND col1_2 > 0;
col1_1	col2_2
1	3
2	3
3	3
SELECT tbl1.col1_1, t.col2_2 FROM tbl1 INNER JOIN (SELECT col2_1, col2_2 FROM tbl2 WHERE col2_1 > 0) t ON col1_2 = col2_2
WHERE tbl1.col1_2 IN (1,2,3) AND t.col2_2 <> 0;
col1_1	col2_2
2	3
SELECT t1.col1_1, t2.col2_2 AS c2 FROM tbl1 t1 JOIN tbl2 t2 ON t1.col1_2 > col2_2;
col1_1	c2
3	3
SELECT t1.col1_1, t2.col1_2 FROM tbl1 t1, tbl1 t2
WHERE t1.col1_1 = t2.col1_1 AND t1.col1_2 > 10 AND t2.col1_2 > 5;
col1_1	col1_2
SELECT t1.col1_1, t2.col1_2 FROM tbl1 t1, tbl1 t2
WHERE t1.col1_1 = t2.col1_1 AND t1.col1_2 > 10 AND t2.col1_2 <= 5;
col1_1	col1_2
SELECT COUNT(DISTINCT SQL_ID) FROM performance_schema.column_statistics;
COUNT(DISTINCT SQL_ID)
13
SELECT SQL_ID, DIGEST_TEXT, TABLE_SCHEMA, TABLE_NAME, COLUMN_NAME, SQL_OPERATION, OPERATOR_TYPE
FROM performance_schema.column_statistics cs, performance_schema.events_statements_summary_by_all mt, performance_schema.sql_text st
WHERE TABLE_SCHEMA <> 'performance_schema' AND cs.SQL_ID = mt.DIGEST AND  cs.SQL_ID = st.DIGEST
ORDER BY SQL_ID, DIGEST_TEXT, TABLE_SCHEMA, TABLE_NAME, COLUMN_NAME, SQL_OPERATION, OPERATOR_TYPE;
SQL_ID	0d3d1a8c023ff6daffb735c03abd343b
DIGEST_TEXT	SELECT `tbl1` . `col1_1` , `tbl2` . `col2_2` FROM `tbl1` JOIN `tbl2` ON `tbl1` . `col1_2` = `col2_2` WHERE `tbl1` . `col1_2` IN (...)
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	EQUAL
SQL_ID	0d3d1a8c023ff6daffb735c03abd343b
DIGEST_TEXT	SELECT `tbl1` . `col1_1` , `tbl2` . `col2_2` FROM `tbl1` JOIN `tbl2` ON `tbl1` . `col1_2` = `col2_2` WHERE `tbl1` . `col1_2` IN (...)
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	SET_MEMBERSHIP
SQL_ID	0d3d1a8c023ff6daffb735c03abd343b
DIGEST_TEXT	SELECT `tbl1` . `col1_1` , `tbl2` . `col2_2` FROM `tbl1` JOIN `tbl2` ON `tbl1` . `col1_2` = `col2_2` WHERE `tbl1` . `col1_2` IN (...)
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl2
COLUMN_NAME	col2_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	EQUAL
SQL_ID	1f949c64305bc418dc4c5c48f19093fe
DIGEST_TEXT	SELECT * FROM `tbl1` NATURAL JOIN `tbl3`
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_1
SQL_OPERATION	FILTER
OPERATOR_TYPE	EQUAL
SQL_ID	1f949c64305bc418dc4c5c48f19093fe
DIGEST_TEXT	SELECT * FROM `tbl1` NATURAL JOIN `tbl3`
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	EQUAL
SQL_ID	1f949c64305bc418dc4c5c48f19093fe
DIGEST_TEXT	SELECT * FROM `tbl1` NATURAL JOIN `tbl3`
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl3
COLUMN_NAME	col1_1
SQL_OPERATION	FILTER
OPERATOR_TYPE	EQUAL
SQL_ID	1f949c64305bc418dc4c5c48f19093fe
DIGEST_TEXT	SELECT * FROM `tbl1` NATURAL JOIN `tbl3`
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl3
COLUMN_NAME	col1_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	EQUAL
SQL_ID	20424a48bed50f0306e67de9d0a88211
DIGEST_TEXT	SELECT `col1_1` , `col2_2` FROM `tbl1` STRAIGHT_JOIN `tbl2` ON `col1_2` = `col2_2`
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	EQUAL
SQL_ID	20424a48bed50f0306e67de9d0a88211
DIGEST_TEXT	SELECT `col1_1` , `col2_2` FROM `tbl1` STRAIGHT_JOIN `tbl2` ON `col1_2` = `col2_2`
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl2
COLUMN_NAME	col2_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	EQUAL
SQL_ID	269dffc102f58ca945c505f45ff5a93b
DIGEST_TEXT	SELECT `tbl1` . `col1_1` , `tbl2` . `col2_2` FROM `tbl1` JOIN `tbl2` ON `tbl1` . `col1_2` > `col2_2`
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	GREATER_THAN
SQL_ID	269dffc102f58ca945c505f45ff5a93b
DIGEST_TEXT	SELECT `tbl1` . `col1_1` , `tbl2` . `col2_2` FROM `tbl1` JOIN `tbl2` ON `tbl1` . `col1_2` > `col2_2`
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl2
COLUMN_NAME	col2_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	GREATER_THAN
SQL_ID	26a3839ca1d896f6d90cd236eb99af03
DIGEST_TEXT	SELECT `tbl1` . `col1_1` , `col2_2` FROM `tbl1` , ( SELECT * FROM `tbl2` WHERE `col2_2` = ? ) `t2` WHERE `col2_1` = ? AND `col1_2` > ?
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	GREATER_THAN
SQL_ID	26a3839ca1d896f6d90cd236eb99af03
DIGEST_TEXT	SELECT `tbl1` . `col1_1` , `col2_2` FROM `tbl1` , ( SELECT * FROM `tbl2` WHERE `col2_2` = ? ) `t2` WHERE `col2_1` = ? AND `col1_2` > ?
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl2
COLUMN_NAME	col2_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	EQUAL
SQL_ID	39cacfdffc7808de038caed3609d58c0
DIGEST_TEXT	SELECT * FROM `tbl1` JOIN `tbl3` USING ( `col1_2` )
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	EQUAL
SQL_ID	39cacfdffc7808de038caed3609d58c0
DIGEST_TEXT	SELECT * FROM `tbl1` JOIN `tbl3` USING ( `col1_2` )
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl3
COLUMN_NAME	col1_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	EQUAL
SQL_ID	4ba91160b7a1792983e3ee1b72c971c4
DIGEST_TEXT	SELECT `t1` . `col1_1` , `t2` . `col1_2` FROM `tbl1` `t1` , `tbl1` `t2` WHERE `t1` . `col1_1` = `t2` . `col1_1` AND `t1` . `col1_2` > ? AND `t2` . `col1_2` > ?
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_1
SQL_OPERATION	FILTER
OPERATOR_TYPE	EQUAL
SQL_ID	4ba91160b7a1792983e3ee1b72c971c4
DIGEST_TEXT	SELECT `t1` . `col1_1` , `t2` . `col1_2` FROM `tbl1` `t1` , `tbl1` `t2` WHERE `t1` . `col1_1` = `t2` . `col1_1` AND `t1` . `col1_2` > ? AND `t2` . `col1_2` > ?
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_1
SQL_OPERATION	FILTER
OPERATOR_TYPE	EQUAL
SQL_ID	4ba91160b7a1792983e3ee1b72c971c4
DIGEST_TEXT	SELECT `t1` . `col1_1` , `t2` . `col1_2` FROM `tbl1` `t1` , `tbl1` `t2` WHERE `t1` . `col1_1` = `t2` . `col1_1` AND `t1` . `col1_2` > ? AND `t2` . `col1_2` > ?
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	GREATER_THAN
SQL_ID	4ba91160b7a1792983e3ee1b72c971c4
DIGEST_TEXT	SELECT `t1` . `col1_1` , `t2` . `col1_2` FROM `tbl1` `t1` , `tbl1` `t2` WHERE `t1` . `col1_1` = `t2` . `col1_1` AND `t1` . `col1_2` > ? AND `t2` . `col1_2` > ?
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	GREATER_THAN
SQL_ID	5489ba6a711488f0fb1a7b45ae9da274
DIGEST_TEXT	SELECT `tbl1` . `col1_1` , `t` . `col2_2` FROM `tbl1` INNER JOIN ( SELECT `col2_1` , `col2_2` FROM `tbl2` WHERE `col2_1` > ? ) `t` ON `col1_2` = `col2_2` WHERE `tbl1` . `col1_2` IN (...) AND `t` . `col2_2` != ?
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	EQUAL
SQL_ID	5489ba6a711488f0fb1a7b45ae9da274
DIGEST_TEXT	SELECT `tbl1` . `col1_1` , `t` . `col2_2` FROM `tbl1` INNER JOIN ( SELECT `col2_1` , `col2_2` FROM `tbl2` WHERE `col2_1` > ? ) `t` ON `col1_2` = `col2_2` WHERE `tbl1` . `col1_2` IN (...) AND `t` . `col2_2` != ?
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	SET_MEMBERSHIP
SQL_ID	5489ba6a711488f0fb1a7b45ae9da274
DIGEST_TEXT	SELECT `tbl1` . `col1_1` , `t` . `col2_2` FROM `tbl1` INNER JOIN ( SELECT `col2_1` , `col2_2` FROM `tbl2` WHERE `col2_1` > ? ) `t` ON `col1_2` = `col2_2` WHERE `tbl1` . `col1_2` IN (...) AND `t` . `col2_2` != ?
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl2
COLUMN_NAME	col2_1
SQL_OPERATION	FILTER
OPERATOR_TYPE	GREATER_THAN
SQL_ID	9d721f60f8385bcbf35b2b215c8d41cd
DIGEST_TEXT	SELECT `tbl1` . `col1_1` , `tbl2` . `col2_2` FROM `tbl1` , `tbl2` WHERE `tbl1` . `col1_2` IN (...)
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	SET_MEMBERSHIP
SQL_ID	b210f097537cac9b309045d6ec7aca15
DIGEST_TEXT	SELECT * FROM ( `tbl1` , `tbl2` ) JOIN `tbl3` ON ( `tbl1` . `col1_1` = `tbl3` . `col1_1` )
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_1
SQL_OPERATION	FILTER
OPERATOR_TYPE	EQUAL
SQL_ID	b210f097537cac9b309045d6ec7aca15
DIGEST_TEXT	SELECT * FROM ( `tbl1` , `tbl2` ) JOIN `tbl3` ON ( `tbl1` . `col1_1` = `tbl3` . `col1_1` )
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl3
COLUMN_NAME	col1_1
SQL_OPERATION	FILTER
OPERATOR_TYPE	EQUAL
SQL_ID	f3d2c2a9df0058b25afe9b110148e33f
DIGEST_TEXT	SELECT `t1` . `col1_1` , `t2` . `col1_2` FROM `tbl1` `t1` , `tbl1` `t2` WHERE `t1` . `col1_1` = `t2` . `col1_1` AND `t1` . `col1_2` > ? AND `t2` . `col1_2` <= ?
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_1
SQL_OPERATION	FILTER
OPERATOR_TYPE	EQUAL
SQL_ID	f3d2c2a9df0058b25afe9b110148e33f
DIGEST_TEXT	SELECT `t1` . `col1_1` , `t2` . `col1_2` FROM `tbl1` `t1` , `tbl1` `t2` WHERE `t1` . `col1_1` = `t2` . `col1_1` AND `t1` . `col1_2` > ? AND `t2` . `col1_2` <= ?
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_1
SQL_OPERATION	FILTER
OPERATOR_TYPE	EQUAL
SQL_ID	f3d2c2a9df0058b25afe9b110148e33f
DIGEST_TEXT	SELECT `t1` . `col1_1` , `t2` . `col1_2` FROM `tbl1` `t1` , `tbl1` `t2` WHERE `t1` . `col1_1` = `t2` . `col1_1` AND `t1` . `col1_2` > ? AND `t2` . `col1_2` <= ?
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	GREATER_THAN
SQL_ID	f3d2c2a9df0058b25afe9b110148e33f
DIGEST_TEXT	SELECT `t1` . `col1_1` , `t2` . `col1_2` FROM `tbl1` `t1` , `tbl1` `t2` WHERE `t1` . `col1_1` = `t2` . `col1_1` AND `t1` . `col1_2` > ? AND `t2` . `col1_2` <= ?
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	LESS_THAN_EQUAL
SQL_ID	f72cd739ff314f57e9c61218e7a93e14
DIGEST_TEXT	SELECT `t1` . `col1_1` , `t2` . `col2_2` AS `c2` FROM `tbl1` `t1` JOIN `tbl2` `t2` ON `t1` . `col1_2` > `col2_2`
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	GREATER_THAN
SQL_ID	f72cd739ff314f57e9c61218e7a93e14
DIGEST_TEXT	SELECT `t1` . `col1_1` , `t2` . `col2_2` AS `c2` FROM `tbl1` `t1` JOIN `tbl2` `t2` ON `t1` . `col1_2` > `col2_2`
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl2
COLUMN_NAME	col2_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	GREATER_THAN
SQL_ID	f85b97e5a2c5e1e1058e3e3e38cb61d0
DIGEST_TEXT	SELECT `col1_1` , `col2_2` FROM `tbl1` INNER JOIN `tbl2` ON `col1_2` = `col2_2` WHERE `col1_1` IN (...)
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_1
SQL_OPERATION	FILTER
OPERATOR_TYPE	SET_MEMBERSHIP
SQL_ID	f85b97e5a2c5e1e1058e3e3e38cb61d0
DIGEST_TEXT	SELECT `col1_1` , `col2_2` FROM `tbl1` INNER JOIN `tbl2` ON `col1_2` = `col2_2` WHERE `col1_1` IN (...)
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl1
COLUMN_NAME	col1_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	EQUAL
SQL_ID	f85b97e5a2c5e1e1058e3e3e38cb61d0
DIGEST_TEXT	SELECT `col1_1` , `col2_2` FROM `tbl1` INNER JOIN `tbl2` ON `col1_2` = `col2_2` WHERE `col1_1` IN (...)
TABLE_SCHEMA	cus_test
TABLE_NAME	tbl2
COLUMN_NAME	col2_2
SQL_OPERATION	FILTER
OPERATOR_TYPE	EQUAL
set global column_stats_control = OFF_HARD;
SET @@global.performance_schema_esms_by_all = @start_value;
DROP TABLE tbl1;
DROP TABLE tbl2;
DROP TABLE tbl3;
DROP DATABASE cus_test;
